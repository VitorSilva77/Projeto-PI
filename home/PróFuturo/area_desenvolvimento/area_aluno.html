<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PróFuturo</title>
  <link rel="icon" href="./Material/images/teste1.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./area_aluno.css">
  <link rel="stylesheet" href="./css/modal.css">
  <link rel="stylesheet" href="./css/profile-menu.css">
  <link rel="stylesheet" href="./css/navbar.css">
</head>
<body>
 
  <header class="main-header">
    <img src="./Material/images/teste1.png" alt="Pró Futuro" class="logo" />
    <nav class="main-nav">
      <a href="#cursos">Meus Cursos</a>
      <a href="#depoimentos">Depoimentos</a>
      <a href="#suporte">Suporte</a>
      
      <div class="nav-icons">
        <button class="dark-toggle" onclick="toggleDarkMode()" aria-label="Alternar tema">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 011.06.04l1.5 1.5a.75.75 0 01-1.06 1.06l-1.5-1.5a.75.75 0 01.04-1.06zM19.958 13.5a.75.75 0 001.06-1.06l-1.5-1.5a.75.75 0 00-1.06 1.06l1.5 1.5zM12 18a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM6.106 18.894a.75.75 0 011.06-.04l1.5 1.5a.75.75 0 01-1.06 1.06l-1.5-1.5a.75.75 0 01.04-1.06zM5.042 13.5a.75.75 0 00-1.06-1.06l-1.5 1.5a.75.75 0 001.06 1.06l1.5-1.5zM2.25 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3a.75.75 0 01-.75-.75z"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20" style="display: none;">
            <path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-3.51 1.713-6.622 4.371-8.552a.75.75 0 01.819.162z" clip-rule="evenodd" />
          </svg>
        </button>
        
        <!-- Menu de Perfil (Três Pontinhos) -->
        <div class="profile-menu">
          <button class="profile-menu-button" id="profileMenuButton" aria-label="Menu de perfil">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
              <path fill-rule="evenodd" d="M4.5 12a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm6 0a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm6 0a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z" clip-rule="evenodd" />
            </svg>
          </button>
          <div class="profile-menu-dropdown" id="profileMenuDropdown">
            <div class="profile-menu-header">
              <div class="profile-menu-avatar">
                <div class="profile-menu-avatar-placeholder" id="profileInitials">A</div>
              </div>
              <div class="profile-menu-info">
                <div class="profile-menu-username" id="profileMenuName">Aluno(a)</div>
                <div class="profile-menu-email" id="profileMenuEmail">aluno@email.com</div>
              </div>
            </div>
            <div class="profile-menu-options">
              <a href="#" onclick="abrirModalEditarPerfil(); return false;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M21.731 2.269a2.625 2.625 0 00-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 000-3.712zM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 00-1.32 2.214l-.8 2.685a.75.75 0 00.933.933l2.685-.8a5.25 5.25 0 002.214-1.32L19.513 8.2z" />
                </svg>
                Editar Perfil
              </a>
              <a href="#" onclick="alterarSenha(); return false;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path fill-rule="evenodd" d="M12 1.5a5.25 5.25 0 00-5.25 5.25v3a3 3 0 00-3 3v6.75a3 3 0 003 3h10.5a3 3 0 003-3v-6.75a3 3 0 00-3-3v-3c0-2.9-2.35-5.25-5.25-5.25zm3.75 8.25v-3a3.75 3.75 0 10-7.5 0v3h7.5z" clip-rule="evenodd" />
                </svg>
                Alterar Senha
              </a>
              <a href="#" onclick="fazerLogout(); return false;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 006 5.25v13.5a1.5 1.5 0 001.5 1.5h6a1.5 1.5 0 001.5-1.5V15a.75.75 0 011.5 0v3.75a3 3 0 01-3 3h-6a3 3 0 01-3-3V5.25a3 3 0 013-3h6a3 3 0 013 3V9A.75.75 0 0115 9V5.25a1.5 1.5 0 00-1.5-1.5h-6zm10.72 4.72a.75.75 0 011.06 0l3 3a.75.75 0 010 1.06l-3 3a.75.75 0 11-1.06-1.06l1.72-1.72H9a.75.75 0 010-1.5h10.94l-1.72-1.72a.75.75 0 010-1.06z" clip-rule="evenodd" />
                </svg>
                Sair
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <main class="container">
    <section class="welcome-section">
      <h1>Bem-vindo(a) de volta, <span id="nome-aluno">Aluno(a)</span>!</h1>
      <p>Continue seu aprendizado e explore novos conhecimentos.</p>
    </section>

    <section id="cursos" class="cursos-section">
      <h2>Seus Cursos</h2>
      <div class="grid-cursos">
        
        <div class="card-curso">
          <img src="./Material/images/auxiliar-administrativo.svg" alt="Curso de Auxiliar Administrativo" />
          <div class="conteudo">
            <h3>Auxiliar Administrativo</h3>
            <div class="progresso">
              <div class="barra-progresso-bg"><div class="barra-progresso" style="width: 75%;"></div></div>
              <span>75% concluído</span>
            </div>
            <a href="https://hotmart.com/link-curso1" target="_blank" class="btn-acessar">Continuar Curso</a>
          </div>
        </div>
        
        <div class="card-curso">
          <img src="./Material/images/Secretariado-Basico.svg" alt="Curso de Secretariado Básico" />
          <div class="conteudo">
            <h3>Secretariado Básico</h3>
             <div class="progresso">
              <div class="barra-progresso-bg"><div class="barra-progresso" style="width: 30%;"></div></div>
              <span>30% concluído</span>
            </div>
            <a href="https://hotmart.com/link-curso2" target="_blank" class="btn-acessar">Continuar Curso</a>
          </div>
        </div>
        
        <div class="card-curso">
          <img src="./Material/images/vendas-varejo.svg" alt="Curso de Vendas no Varejo" />
          <div class="conteudo">
            <h3>Vendas no Varejo</h3>
             <div class="progresso">
              <div class="barra-progresso-bg"><div class="barra-progresso" style="width: 10%;"></div></div>
              <span>10% concluído</span>
            </div>
            <a href="https://hotmart.com/link-curso3" target="_blank" class="btn-acessar">Iniciar Curso</a>
          </div>
        </div>
        
        <div class="card-curso">
          <img src="./Material/images/aprenda-youtube.svg" alt="Curso: Aprenda a Ser Youtuber" />
          <div class="conteudo">
            <h3>Aprenda a Ser Youtuber</h3>
             <div class="progresso">
              <div class="barra-progresso-bg"><div class="barra-progresso" style="width: 0%;"></div></div>
              <span>Não iniciado</span>
            </div>
            <a href="https://hotmart.com/link-curso4" target="_blank" class="btn-acessar">Iniciar Curso</a>
          </div>
        </div>
      </div>
    </section>

    <section id="depoimentos" class="depoimentos-section">
      <h2>O que nossos alunos dizem</h2>
      <div class="grid-depoimentos">
        <div class="card-depoimento">
          <p>"A plataforma é intuitiva e os cursos são direto ao ponto. O de Auxiliar Administrativo me ajudou a conseguir uma promoção!"</p>
          <div class="autor">
            <img src="./Material/images/image3.png" alt="Avatar Camila S.">
            <span>Camila S.</span>
          </div>
        </div>
        <div class="card-depoimento">
          <p>"Finalmente perdi o medo de vender! O curso de Vendas no Varejo foi um divisor de águas para mim. Recomendo demais!"</p>
           <div class="autor">
            <img src="./Material/images/image2.png" alt="Avatar Rafael T.">
            <span>Rafael T.</span>
          </div>
        </div>
        <div class="card-depoimento">
          <p>"Didática excelente, conteúdo sempre atualizado e uma verdadeira preocupação com o sucesso de cada aluno. Recomendo muito!"</p>
           <div class="autor">
            <img src="./Material/images/image1.png" alt="Avatar Juliana M.">
            <span>Juliana M.</span>
          </div>
        </div>
      </div>
    </section>

     <section id="suporte" class="suporte-section">
        <h2>Precisa de Ajuda?</h2>
        <p>Nossa equipe de suporte está pronta para te auxiliar. Entre em contato pelos canais abaixo:</p>
        <div class="contatos-suporte">
            <a href="mailto:suporte@profuturo.com.br" class="contato-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M1.5 8.67v8.58a3 3 0 003 3h15a3 3 0 003-3V8.67l-8.928 5.493a3 3 0 01-3.144 0L1.5 8.67z" /><path d="M22.5 6.908V6.75a3 3 0 00-3-3h-15a3 3 0 00-3 3v.158l9.714 5.978a1.5 1.5 0 001.572 0L22.5 6.908z" /></svg>
                <span>suporte@profuturo.com.br</span>
            </a>
            <a href="https://wa.me/55XXXXXXXXXXX" target="_blank" class="contato-item">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path fill-rule="evenodd" d="M18.97 3.659a2.25 2.25 0 00-3.182 0l-10.94 10.94a2.25 2.25 0 000 3.182l10.94 10.94a2.25 2.25 0 003.182-3.182L9.182 12l9.788-8.341a2.25 2.25 0 000-3.182z" clip-rule="evenodd" /></svg> <!-- Ícone placeholder para WhatsApp -->
                <span>WhatsApp Suporte</span>
            </a>
        </div>
    </section>

  </main>

  <footer class="main-footer">
    <p>© 2025 Pró Futuro Cursos & Treinamentos. Todos os direitos reservados.</p>
    <p><a href="#termos">Termos de Uso</a> | <a href="#privacidade">Política de Privacidade</a></p>
  </footer>

  <!-- Modal de Edição de Perfil -->
  <div id="modalEditarPerfil" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharModalEditarPerfil()">&times;</span>
      
      <!-- Formulário de Edição -->
      <div id="formEdicao">
        <h2>Editar Perfil</h2>
        <div class="form-group">
          <label for="edit-nome">Nome</label>
          <input type="text" id="edit-nome" placeholder="Seu nome completo">
        </div>
        <div class="form-group">
          <label for="edit-email">E-mail</label>
          <input type="email" id="edit-email" placeholder="Seu e-mail">
        </div>
        <div class="form-group">
          <label for="edit-senha">Nova Senha (deixe em branco para manter a atual)</label>
          <input type="password" id="edit-senha" placeholder="Nova senha">
        </div>
        <div class="btn-group">
          <button class="btn-cancel" onclick="fecharModalEditarPerfil()">Cancelar</button>
          <button class="btn-save" onclick="salvarPerfil()">Salvar Alterações</button>
        </div>
      </div>
      
      <!-- Mensagem de Sucesso (inicialmente oculta) -->
      <div id="mensagemSucesso" class="success-message" style="display: none;">
        <i class="fas fa-check-circle success-icon"></i>
        <h3>Perfil Atualizado com Sucesso!</h3>
        <p>Suas informações foram atualizadas.</p>
        <div class="btn-group" style="justify-content: center;">
          <button class="btn-ok" onclick="fecharModalEditarPerfil()">OK</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Função para alternar o modo escuro
    function toggleDarkMode() {
      const body = document.body;
      body.classList.toggle('dark-mode');
      const isDarkMode = body.classList.contains('dark-mode');
      // Alterna a visibilidade dos SVGs do botão
      const svgs = document.querySelectorAll('.dark-toggle svg');
      svgs[0].style.display = isDarkMode ? 'none' : 'block';
      svgs[1].style.display = isDarkMode ? 'block' : 'none';
      // Salva a preferência no localStorage
      localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
    }

    // Carrega as preferências do usuário ao iniciar
    document.addEventListener('DOMContentLoaded', () => {
      // Verifica o modo escuro
      if (localStorage.getItem('darkMode') === 'enabled') {
        toggleDarkMode();
      }
      
      // Carrega os dados do usuário
      carregarDadosUsuario();
      
      // Configura o menu de perfil
      configurarMenuPerfil();
    });

    // Função para carregar dados do usuário
    function carregarDadosUsuario() {
      const usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
      
      if (!usuarioLogado) {
        // Se não houver usuário logado, redireciona para a página de login
        window.location.href = 'login.html';
        return;
      }
      
      // Atualiza o nome do aluno na página
      const nomeAluno = usuarioLogado.nome || (usuarioLogado.user && usuarioLogado.user.nome) || 'Aluno(a)';
      document.getElementById('nome-aluno').textContent = nomeAluno;
      
      // Atualiza o menu de perfil
      atualizarMenuPerfil(usuarioLogado);
      
      // Preenche o formulário de edição com os dados atuais
      document.getElementById('edit-nome').value = nomeAluno;
      document.getElementById('edit-email').value = usuarioLogado.email || (usuarioLogado.user && usuarioLogado.user.email) || '';
    }
    
    // Função para configurar o menu de perfil
    function configurarMenuPerfil() {
      const menuButton = document.getElementById('profileMenuButton');
      const menuDropdown = document.getElementById('profileMenuDropdown');
      
      // Abre/fecha o menu ao clicar no botão
      menuButton.addEventListener('click', function() {
        menuDropdown.classList.toggle('show');
      });
      
      // Fecha o menu ao clicar fora dele
      window.addEventListener('click', function(event) {
        if (!event.target.matches('.profile-menu-button') && 
            !event.target.closest('.profile-menu-button') && 
            !event.target.closest('.profile-menu-dropdown')) {
          menuDropdown.classList.remove('show');
        }
      });
    }
    
    // Função para atualizar o menu de perfil com os dados do usuário
    function atualizarMenuPerfil(usuarioLogado) {
      const nome = usuarioLogado.nome || (usuarioLogado.user && usuarioLogado.user.nome) || 'Aluno(a)';
      const email = usuarioLogado.email || (usuarioLogado.user && usuarioLogado.user.email) || 'aluno@email.com';
      
      // Atualiza nome e email no menu
      document.getElementById('profileMenuName').textContent = nome;
      document.getElementById('profileMenuEmail').textContent = email;
      
      // Gera as iniciais para o avatar
      const iniciais = nome.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
      document.getElementById('profileInitials').textContent = iniciais;
    }

    // Funções do Modal de Edição de Perfil
    function abrirModalEditarPerfil() {
      document.getElementById('modalEditarPerfil').style.display = 'block';
      document.getElementById('formEdicao').style.display = 'block';
      document.getElementById('mensagemSucesso').style.display = 'none';
      
      // Fecha o menu dropdown se estiver aberto
      document.getElementById('profileMenuDropdown').classList.remove('show');
    }
    
    function fecharModalEditarPerfil() {
      document.getElementById('modalEditarPerfil').style.display = 'none';
    }
    
    // Fecha o modal ao clicar fora dele
    window.onclick = function(event) {
      const modal = document.getElementById('modalEditarPerfil');
      if (event.target === modal) {
        fecharModalEditarPerfil();
      }
    }
    
    // Função para salvar as alterações do perfil
    async function salvarPerfil() {
      const nome = document.getElementById('edit-nome').value.trim();
      const email = document.getElementById('edit-email').value.trim();
      const senha = document.getElementById('edit-senha').value;
      
      // Validação básica
      if (!nome || !email) {
        alert('Por favor, preencha os campos Nome e E-mail.');
        return;
      }
      
      // Prepara os dados para envio
      const dadosAtualizados = { nome, email };
      
      // Adiciona a senha apenas se foi preenchida
      if (senha) {
        dadosAtualizados.senha = senha;
      }
      
      try {
        // Obtém o usuário logado
        const usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
        
        // Determina o ID correto - verifica todas as possibilidades
        let userId = null;
        if (usuarioLogado && usuarioLogado.id_usuario) {
          userId = usuarioLogado.id_usuario;
        } else if (usuarioLogado && usuarioLogado.id) {
          userId = usuarioLogado.id;
        } else if (usuarioLogado && usuarioLogado.user && usuarioLogado.user.id_usuario) {
          userId = usuarioLogado.user.id_usuario;
        } else if (usuarioLogado && usuarioLogado.user && usuarioLogado.user.id) {
          userId = usuarioLogado.user.id;
        }
        
        if (!userId) {
          throw new Error('ID do usuário não encontrado');
        }
        
        // Envia a requisição para a API
        const response = await fetch(`http://localhost:4040/users/${userId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(dadosAtualizados)
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          // Atualiza os dados do usuário no localStorage
          if (usuarioLogado.user) {
            // Se o objeto tem a estrutura usuarioLogado.user
            usuarioLogado.user = { ...usuarioLogado.user, ...dadosAtualizados };
          } else {
            // Se o objeto tem a estrutura direta
            Object.assign(usuarioLogado, dadosAtualizados);
          }
          delete usuarioLogado.senha; // Remove a senha por segurança
          localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
          
          // Atualiza o nome na página
          document.getElementById('nome-aluno').textContent = nome;
          
          // Atualiza o menu de perfil
          atualizarMenuPerfil(usuarioLogado);
          
          // Mostra a mensagem de sucesso
          document.getElementById('formEdicao').style.display = 'none';
          document.getElementById('mensagemSucesso').style.display = 'block';
        } else {
          alert(data.message || 'Erro ao atualizar perfil.');
        }
      } catch (error) {
        console.error('Erro ao editar perfil:', error);
        alert('Erro na conexão com o servidor. Por favor, tente novamente.');
      }
    }
    
    // Função para alterar senha (redireciona para o modal de edição)
    function alterarSenha() {
      abrirModalEditarPerfil();
      // Foca no campo de senha
      setTimeout(() => {
        document.getElementById('edit-senha').focus();
      }, 300);
    }
    
    // Função para fazer logout
    function fazerLogout() {
      localStorage.removeItem('usuarioLogado');
      window.location.href = 'login.html';
    }
  </script>
  <script src="./scripts/script_requests.js"></script>
</body>
</html>
